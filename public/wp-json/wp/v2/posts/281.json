{"id":281,"date":"2018-03-22T19:24:28","date_gmt":"2018-03-22T19:24:28","guid":{"rendered":"http:\/\/wp-archive.zachbrogan.com\/?p=281"},"modified":"2018-03-24T02:44:49","modified_gmt":"2018-03-24T02:44:49","slug":"hvac-software","status":"publish","type":"post","link":"https:\/\/wp-archive.zachbrogan.com\/byu-iot-lab\/hvac-software\/","title":{"rendered":"HVAC Software"},"content":{"rendered":"<h2>Arduino code for esp8266-based hvac<\/h2>\n<p>As mentioned in the previous post, I chose to use the esp8266 for developing the hvac controller. The esp8266 is super cheap and relatively easy to use: perfect for IoT prototyping. There are a number of ways to write software for it, but I opted to use the Arduino IDE because the documentation, libraries, and community are pretty helpful. The board definitions for the esp just had to be added to the environment before any code could be uploaded to the esp. Instructions on how to do that are here:\u00a0<a href=\"https:\/\/wiki.wemos.cc\/tutorials:get_started:get_started_in_arduino\">https:\/\/wiki.wemos.cc\/tutorials:get_started:get_started_in_arduino<\/a><\/p>\n<p>The hvac software isn&#8217;t terribly complicated. It can be found at <a href=\"https:\/\/github.com\/zbrogz\/hvac\">https:\/\/github.com\/zbrogz\/hvac<\/a> Basically, the esp8266 retrieves it&#8217;s state from a Rest HTTP api in json format, and turns on\/off the associated pins for heater\/ac\/fan as dictated by the state. Every so often, it should retrieve its state again (based on the update_period variable). There are four possible states for the hvac controller to be in:<\/p>\n<p><strong>Heating<\/strong> (heater and fan on)<br \/>\n<strong>Cooling<\/strong> (ac and fan on)<br \/>\n<strong>Ventilating<\/strong> (fan on)<br \/>\n<strong>Idle<\/strong> (nothing on)<\/p>\n<p>The heater and ac should never be on at the same time, so the software should ensure that the web api never provides an invalid state. Here is a summary of what the code does:<\/p>\n<ol>\n<li>Connect to WiFi<\/li>\n<li>Retrieve state from web api<\/li>\n<li>Verify state<\/li>\n<li>Execute state by turning on\/off the pins for heater\/ac\/fan<\/li>\n<li>Repeat from step 2 after waiting a short period<\/li>\n<\/ol>\n<p>Currently the WiFi ssid and password, as well as api url, have to be hard coded before uploading the image to the esp. In the future I intend on adding a feature access point mode. Access point mode is where the esp device hosts its own mini wifi network that the user can join from their phone or computer. Inside this network, the esp hosts a web server with a form for configuring parameters like wifi and api url. I&#8217;ll probably end up using this Arduino library somebody created called Wifi Manager:\u00a0<a href=\"https:\/\/github.com\/tzapu\/WiFiManager\">https:\/\/github.com\/tzapu\/WiFiManager<\/a>.<\/p>\n","protected":false},"excerpt":{"rendered":"<p>Arduino code for esp8266-based hvac As mentioned in the previous post, I chose to use the esp8266 for developing the hvac controller. The esp8266 is super cheap and relatively easy to use: perfect for IoT prototyping. There are a number of ways to write software for it, but I opted [&hellip;]<\/p>\n","protected":false},"author":1,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":[],"categories":[8],"tags":[],"_links":{"self":[{"href":"https:\/\/wp-archive.zachbrogan.com\/wp-json\/wp\/v2\/posts\/281"}],"collection":[{"href":"https:\/\/wp-archive.zachbrogan.com\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/wp-archive.zachbrogan.com\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/wp-archive.zachbrogan.com\/wp-json\/wp\/v2\/users\/1"}],"replies":[{"embeddable":true,"href":"https:\/\/wp-archive.zachbrogan.com\/wp-json\/wp\/v2\/comments?post=281"}],"version-history":[{"count":5,"href":"https:\/\/wp-archive.zachbrogan.com\/wp-json\/wp\/v2\/posts\/281\/revisions"}],"predecessor-version":[{"id":289,"href":"https:\/\/wp-archive.zachbrogan.com\/wp-json\/wp\/v2\/posts\/281\/revisions\/289"}],"wp:attachment":[{"href":"https:\/\/wp-archive.zachbrogan.com\/wp-json\/wp\/v2\/media?parent=281"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/wp-archive.zachbrogan.com\/wp-json\/wp\/v2\/categories?post=281"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/wp-archive.zachbrogan.com\/wp-json\/wp\/v2\/tags?post=281"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}